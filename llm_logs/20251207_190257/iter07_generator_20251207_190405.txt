================================================================================
GENERATOR LLM LOG
Iteration: 7
Timestamp: 20251207_190405
Temperature: 0.7999999999999999
No improvement count: 3
================================================================================

--------------------------------------------------------------------------------
SYSTEM PROMPT
--------------------------------------------------------------------------------
You are an expert AI strategist specializing in turn-based RPG combat and Behaviour Tree design.

CRITICAL: The Behaviour Tree executes ONLY ONE action per turn. Once an action is selected, the turn ends immediately.

Your expertise includes:
- Elemental weakness exploitation (Fire/Ice/Lightning rock-paper-scissors)
- Resource management (TP/MP optimization)
- Status effect timing and usage
- Enemy pattern recognition and adaptation
- Defensive vs aggressive strategy selection

Always output valid BT DSL following the specification exactly. Use 4 spaces for indentation.
You must ONLY use the control nodes (root, selector, sequence), conditions, and tasks listed in the DSL specification.

--------------------------------------------------------------------------------
USER PROMPT
--------------------------------------------------------------------------------
Generate an IMPROVED Behaviour Tree based on feedback.

# Current Behaviour Tree
```
root :
    selector :
        # Reactive Defense
        sequence :
            condition : EnemyIsTelegraphing(HeavySlam)
            task : Defend()

        # Scan on turn 1 and 5
        selector :
            sequence :
                condition : IsTurnEarly(1)
                task : Scan()
            sequence :
                condition : IsTurnEarly(5)
                task : Scan()

        # Prioritize IceSpell when enemy is weak
        sequence :
            condition : HasScannedEnemy()
            condition : EnemyWeakTo(Ice)
            condition : HasMP(20)
            condition : HasTP(20)
            task : IceSpell()

        # Heal when player is low and enemy is strong
        sequence :
            condition : IsPlayerHPLow(30)
            condition : IsEnemyHPLow(60)
            condition : CanHeal()
            task : Heal()

        # Exploit weakness
        selector :
            sequence :
                condition : HasScannedEnemy()
                condition : EnemyWeakTo(Fire)
                condition : HasMP(20)
                condition : HasTP(20)
                task : FireSpell()
            sequence :
                condition : HasScannedEnemy()
                condition : EnemyWeakTo(Lightning)
                condition : HasMP(20)
                condition : HasTP(20)
                task : LightningSpell()

        # Default: Attack
        task : Attack()
```

# Improvement Feedback
## Analysis
The combat consistently resulted in defeat against the FireGolem, primarily due to a reactive and inflexible behaviour tree. The BT relies heavily on scanning and then reacting to a single weakness (Fire) after the enemy has already established dominance. The frequent use of ‘FireSpell’ after scanning, combined with the lack of proactive defense and healing, allowed the FireGolem to relentlessly apply pressure and quickly deplete the player’s HP. The BT doesn’t adapt to the enemy’s aggressive tactics or prioritize defense when the enemy is at full health. The TP/MP usage isn't optimized, as the BT always uses 20 TP and 20 MP for spells, regardless of the situation.

## Improvement Suggestions
1.  **Implement Proactive Scanning:**  Modify the BT to scan the enemy at the *start* of each turn, not just on turns 1 and 5. This allows for immediate identification of vulnerabilities and prioritizes the correct spell from the outset.
2.  **Prioritize Defensive Actions:** Introduce a higher priority defensive action – a ‘Defend’ task should be executed *before* spellcasting if the enemy is at a high HP percentage (e.g., >70%). This should be a higher priority than spellcasting when the enemy is healthy.
3.  **Dynamic Spell Selection:** Replace the hardcoded TP/MP requirements for spells with a condition that checks for the *highest* damage potential based on the enemy's weaknesses and the player's available resources.  For example, if Ice is the strongest option, prioritize it regardless of TP/MP, but if Fire is the only option and the player has sufficient resources, use FireSpell.
4.  **Implement a Low HP Healing Trigger:** Change the heal trigger from “IsPlayerHPLow(30)” to “IsPlayerHPLow(20)”. This will allow the player to heal earlier, before the enemy has a chance to inflict significant damage.
5.  **Introduce a ‘Counter-Attack’ Task:** Add a basic ‘Attack’ task with a low priority. This provides a fallback option when no other conditions are met, preventing the BT from simply idling and waiting for the enemy to attack.

# COMPLETE LIST OF AVAILABLE SYNTAX

**Control Nodes (ONLY these 3):**
- `root :` - Must be first line, has one child
- `selector :` - Tries children until one succeeds
- `sequence :` - All conditions must pass, executes final task

**Conditions (ONLY these):**
- `IsPlayerHPLow(30)` - Player HP < threshold%
- `IsEnemyHPLow(30)` - Enemy HP < threshold%
- `HasTP(30)` - Player has >= amount TP
- `HasMP(20)` - Player has >= amount MP
- `CanHeal()` - Heal is off cooldown AND MP >= 30
- `EnemyWeakTo(Fire)` or `EnemyWeakTo(Ice)` or `EnemyWeakTo(Lightning)` - Enemy weak to element
- `HasScannedEnemy()` - Enemy has been scanned
- `EnemyHasBuff(Enrage)` - Enemy has specific buff
- `EnemyIsTelegraphing(HeavySlam)` - Enemy telegraphing attack
- `IsTurnEarly(2)` - Turn count <= threshold

**Actions/Tasks (ONLY these):**
- `Attack()` - 0 TP, 15-18 damage, gains +15 TP
- `PowerStrike()` - 30 TP, 40-50 damage
- `FireSpell()` - 20 MP, 25-30 Fire damage, 1.5x vs Ice
- `IceSpell()` - 20 MP, 25-30 Ice damage, 1.5x vs Lightning
- `LightningSpell()` - 20 MP, 25-30 Lightning damage, 1.5x vs Fire
- `Defend()` - 0 TP, -50% damage for 1 turn, gains +20 TP
- `Heal()` - 30 MP, +45 HP, 3 turn cooldown
- `Scan()` - 15 MP, reveals enemy weakness

# CRITICAL RULES

1. **ONE ACTION PER TURN**: The BT executes ONLY ONE action per turn. Once a task is selected, the turn ends.
2. **USE ONLY LISTED SYNTAX ABOVE**: You must use ONLY the control nodes, conditions, and tasks listed above. No other syntax exists.
3. **Indentation**: Use exactly 4 spaces per level
4. **Format**: `condition : IsPlayerHPLow(30)` and `task : Heal()`
5. **Fallback**: Always end selector with `task : Attack()`

# Your Task

Apply the feedback to create an improved BT using ONLY the syntax listed above. Output ONLY the BT DSL, no explanations. Start with `root :`.

--------------------------------------------------------------------------------
RESPONSE
--------------------------------------------------------------------------------
```
root :
    selector :
        # Emergency Heal
        sequence :
            condition : IsPlayerHPLow(20)
            condition : CanHeal()
            task : Heal()

        # Proactive Defense
        sequence :
            condition : IsEnemyHPLow(70)
            condition : EnemyIsTelegraphing(HeavySlam)
            task : Defend()

        # Scan every turn
        task : Scan()

        # Prioritize IceSpell when enemy is weak
        sequence :
            condition : HasScannedEnemy()
            condition : EnemyWeakTo(Ice)
            condition : HasMP(20)
            condition : HasTP(20)
            task : IceSpell()

        # Exploit weakness
        selector :
            sequence :
                condition : HasScannedEnemy()
                condition : EnemyWeakTo(Fire)
                condition : HasMP(20)
                condition : HasTP(20)
                task : FireSpell()
            sequence :
                condition : HasScannedEnemy()
                condition : EnemyWeakTo(Lightning)
                condition : HasMP(20)
                condition : HasTP(20)
                task : LightningSpell()

        # Default: Attack
        task : Attack()
```

================================================================================
Prompt length: 5431 chars
Response length: 1206 chars
================================================================================
