================================================================================
GENERATOR LLM LOG
Iteration: 1
Timestamp: 20251208_214151
Temperature: 0.7
No improvement count: 1
================================================================================

--------------------------------------------------------------------------------
SYSTEM PROMPT
--------------------------------------------------------------------------------
You are an expert AI strategist specializing in turn-based RPG combat and Behaviour Tree design.

CRITICAL: The Behaviour Tree executes ONLY ONE action per turn. Once an action is selected, the turn ends immediately.

Your expertise includes:
- Elemental weakness exploitation (Fire/Ice/Lightning rock-paper-scissors)
- Resource management (TP/MP optimization)
- Status effect timing and usage
- Enemy pattern recognition and adaptation
- Defensive vs aggressive strategy selection

Always output valid BT DSL following the specification exactly. Use 4 spaces for indentation.
You must ONLY use the control nodes (root, selector, sequence), conditions, and tasks listed in the DSL specification.

--------------------------------------------------------------------------------
USER PROMPT
--------------------------------------------------------------------------------
Generate an IMPROVED Behaviour Tree based on feedback.

# Current Behaviour Tree
```
root :
    selector :
        # Turn 1: Scan
        sequence :
            condition : IsTurnEarly(1)
            condition : HasMP(15)
            task : Scan()

        # Exploit Weakness
        sequence :
            condition : HasScannedEnemy()
            condition : EnemyWeakTo(Fire)
            condition : HasMP(20)
            task : IceSpell()
        sequence :
            condition : HasScannedEnemy()
            condition : EnemyWeakTo(Ice)
            condition : HasMP(20)
            task : FireSpell()
        sequence :
            condition : HasScannedEnemy()
            condition : EnemyWeakTo(Lightning)
            condition : HasMP(20)
            task : LightningSpell()

        # Heal when critical
        sequence :
            condition : IsPlayerHPLow(50)
            condition : CanHeal()
            task : Heal()

        # Defend against heavy damage
        sequence :
            condition : IsEnemyTelegraphing(HeavySlam)
            task : Defend()
        
        # Default: Attack
        task : Attack()
```

# Improvement Feedback
## Analysis
The combat resulted in a swift defeat against the FireGolem, primarily due to a failure to capitalize on the scanned weakness and inefficient MP usage. The BT prioritized Ice spells when the FireGolem was clearly weak to Ice, but the MP cost of IceSpell (20) was not justified by the immediate damage output. The BT’s reliance on scanning before attacking is good, but the subsequent spell selection was suboptimal. The Heal task was triggered too late, after the player’s HP was already critically low.  The Defend task was never triggered, despite the FireGolem telegraphing a heavy attack, indicating a failure to recognize and react to the threat.

## Improvement Suggestions
1.  **Prioritize Ice Spell on Turn 1:** Execute IceSpell immediately upon scanning the FireGolem. This maximizes the benefit of the scanned weakness and reduces the FireGolem's health quickly.
2.  **Adjust Heal Threshold:** Increase the HP threshold for the Heal task from 50% to 70%. This will allow the Heal to be triggered earlier, potentially preventing the player from dropping to critical health.
3.  **Add a "Threat Detection" Task:** Introduce a new task that checks for enemy telegraphing (e.g., heavy slam telegraph) and triggers the Defend task. This ensures the BT reacts to immediate threats, rather than relying solely on the initial scan.
4. **MP Cost Optimization:** Reduce the MP cost of IceSpell to 15, to better align with the immediate damage gain. This will allow for more frequent use of the IceSpell when the weakness is exploited.


# COMPLETE LIST OF AVAILABLE SYNTAX

**Control Nodes (ONLY these 3):**
- `root :` - Must be first line, has one child
- `selector :` - Tries children until one succeeds
- `sequence :` - All conditions must pass, executes final task

**Conditions (ONLY these):**
- `IsPlayerHPLow(30)` - Player HP < threshold%
- `IsEnemyHPLow(30)` - Enemy HP < threshold%
- `HasTP(30)` - Player has >= amount TP
- `HasMP(20)` - Player has >= amount MP
- `CanHeal()` - Heal is off cooldown AND MP >= 30
- `EnemyWeakTo(Fire)` or `EnemyWeakTo(Ice)` or `EnemyWeakTo(Lightning)` - Enemy weak to element
- `HasScannedEnemy()` - Enemy has been scanned
- `EnemyHasBuff(Enrage)` - Enemy has specific buff
- `EnemyIsTelegraphing(HeavySlam)` - Enemy telegraphing attack
- `IsTurnEarly(2)` - Turn count <= threshold

**Actions/Tasks (ONLY these):**
- `Attack()` - 0 TP, 15-18 damage, gains +15 TP
- `PowerStrike()` - 30 TP, 40-50 damage
- `FireSpell()` - 20 MP, 25-30 Fire damage, 1.5x vs Ice
- `IceSpell()` - 20 MP, 25-30 Ice damage, 1.5x vs Lightning
- `LightningSpell()` - 20 MP, 25-30 Lightning damage, 1.5x vs Fire
- `Defend()` - 0 TP, -50% damage for 1 turn, gains +20 TP
- `Heal()` - 30 MP, +45 HP, 3 turn cooldown
- `Scan()` - 15 MP, reveals enemy weakness

# CRITICAL RULES

1. **ONE ACTION PER TURN**: The BT executes ONLY ONE action per turn. Once a task is selected, the turn ends.
2. **USE ONLY LISTED SYNTAX ABOVE**: You must use ONLY the control nodes, conditions, and tasks listed above. No other syntax exists.
3. **Indentation**: Use exactly 4 spaces per level
4. **Format**: `condition : IsPlayerHPLow(30)` and `task : Heal()`
5. **Fallback**: Always end selector with `task : Attack()`

# Your Task

Apply the feedback to create an improved BT using ONLY the syntax listed above. Output ONLY the BT DSL, no explanations. Start with `root :`.

--------------------------------------------------------------------------------
RESPONSE
--------------------------------------------------------------------------------
Error: 429 Resource exhausted. Please try again later. Please refer to https://cloud.google.com/vertex-ai/generative-ai/docs/error-code-429 for more details.

================================================================================
Prompt length: 4547 chars
Response length: 157 chars
================================================================================
