================================================================================
GENERATOR LLM LOG
Iteration: 10
Timestamp: 20251208_214335
Temperature: 0.7
No improvement count: 0
================================================================================

--------------------------------------------------------------------------------
SYSTEM PROMPT
--------------------------------------------------------------------------------
You are an expert AI strategist specializing in turn-based RPG combat and Behaviour Tree design.

CRITICAL: The Behaviour Tree executes ONLY ONE action per turn. Once an action is selected, the turn ends immediately.

Your expertise includes:
- Elemental weakness exploitation (Fire/Ice/Lightning rock-paper-scissors)
- Resource management (TP/MP optimization)
- Status effect timing and usage
- Enemy pattern recognition and adaptation
- Defensive vs aggressive strategy selection

Always output valid BT DSL following the specification exactly. Use 4 spaces for indentation.
You must ONLY use the control nodes (root, selector, sequence), conditions, and tasks listed in the DSL specification.

--------------------------------------------------------------------------------
USER PROMPT
--------------------------------------------------------------------------------
Generate an IMPROVED Behaviour Tree based on feedback.

# Current Behaviour Tree
```
root :
    selector :
        # Emergency Defend
        sequence :
            condition : IsPlayerHPLow(60)
            task : Defend()

        # Highest Priority: Fire Exploit
        sequence :
            condition : HasScannedEnemy()
            condition : EnemyWeakTo(Fire)
            condition : HasMP(15)
            task : FireSpell()

        # Ice Exploit
        sequence :
            condition : HasScannedEnemy()
            condition : EnemyWeakTo(Ice)
            condition : HasMP(20)
            task : IceSpell()

        # Lightning Exploit
        sequence :
            condition : HasScannedEnemy()
            condition : EnemyWeakTo(Lightning)
            condition : HasMP(20)
            condition : HasTP(20)
            task : LightningSpell()

        # Heal when critical
        sequence :
            condition : IsPlayerHPLow(50)
            condition : CanHeal()
            task : Heal()

        # Scan if haven't scanned and it's early
        sequence :
            condition : IsTurnEarly(3)
            condition : HasMP(15)
            condition : HasScannedEnemy()
            task : Scan()

        # Power Strike if TP
        sequence :
            condition : HasTP(30)
            task : PowerStrike()

        # Default: Attack
        task : Attack()
```

# Improvement Feedback
## Analysis
The player consistently defaulted to attacking and exploiting elemental weaknesses without proper scanning. The FireGolem’s immunity to fire was not detected, leading to a prolonged, ineffective exchange. The reliance on ‘IsTurnEarly’ for scanning is too rigid and misses opportunities. The Heal task was triggered too late, and the ‘IsPlayerHPLow’ conditions were not aggressive enough to prevent the player from being overwhelmed. The BT prioritizes spellcasting based on weak spot scans, but doesn’t account for the enemy’s potential to adapt or counter.

## Improvement Suggestions
1. **Mandatory Scan on Turn 1:** Add a task at the root of the tree that *always* executes a ‘Scan’ on turn 1. This ensures the enemy’s weaknesses are identified immediately.
2. **Aggressive Heal Threshold:** Adjust the ‘IsPlayerHPLow’ condition to trigger a ‘Heal’ at 30% HP, rather than 50%. This allows for more proactive healing and prevents the player from dropping to critical health.
3. **Prioritize Scan after Attack:** Modify the ‘Scan’ task to execute *after* an attack. This creates a feedback loop: attack, scan, then react based on the scan results. This addresses the issue of not scanning until a turn is almost over.
4. **Conditional Scan Prioritization:**  Introduce a new condition: “EnemyWeakTo(Fire)” at the root. If the enemy is weak to fire, immediately execute the ‘FireSpell’ task. This overrides the ‘IsTurnEarly’ scan for fire weaknesses.
5. **Dynamic Defend:**  Replace the ‘IsPlayerHPLow(60)’ condition with a more responsive ‘IsPlayerHPLow(40)’ to trigger the ‘Defend’ task more frequently, providing a defensive layer against the FireGolem's attacks.

# COMPLETE LIST OF AVAILABLE SYNTAX

**Control Nodes (ONLY these 3):**
- `root :` - Must be first line, has one child
- `selector :` - Tries children until one succeeds
- `sequence :` - All conditions must pass, executes final task

**Conditions (ONLY these):**
- `IsPlayerHPLow(30)` - Player HP < threshold%
- `IsEnemyHPLow(30)` - Enemy HP < threshold%
- `HasTP(30)` - Player has >= amount TP
- `HasMP(20)` - Player has >= amount MP
- `CanHeal()` - Heal is off cooldown AND MP >= 30
- `EnemyWeakTo(Fire)` or `EnemyWeakTo(Ice)` or `EnemyWeakTo(Lightning)` - Enemy weak to element
- `HasScannedEnemy()` - Enemy has been scanned
- `EnemyHasBuff(Enrage)` - Enemy has specific buff
- `EnemyIsTelegraphing(HeavySlam)` - Enemy telegraphing attack
- `IsTurnEarly(2)` - Turn count <= threshold

**Actions/Tasks (ONLY these):**
- `Attack()` - 0 TP, 15-18 damage, gains +15 TP
- `PowerStrike()` - 30 TP, 40-50 damage
- `FireSpell()` - 20 MP, 25-30 Fire damage, 1.5x vs Ice
- `IceSpell()` - 20 MP, 25-30 Ice damage, 1.5x vs Lightning
- `LightningSpell()` - 20 MP, 25-30 Lightning damage, 1.5x vs Fire
- `Defend()` - 0 TP, -50% damage for 1 turn, gains +20 TP
- `Heal()` - 30 MP, +45 HP, 3 turn cooldown
- `Scan()` - 15 MP, reveals enemy weakness

# CRITICAL RULES

1. **ONE ACTION PER TURN**: The BT executes ONLY ONE action per turn. Once a task is selected, the turn ends.
2. **USE ONLY LISTED SYNTAX ABOVE**: You must use ONLY the control nodes, conditions, and tasks listed above. No other syntax exists.
3. **Indentation**: Use exactly 4 spaces per level
4. **Format**: `condition : IsPlayerHPLow(30)` and `task : Heal()`
5. **Fallback**: Always end selector with `task : Attack()`

# Your Task

Apply the feedback to create an improved BT using ONLY the syntax listed above. Output ONLY the BT DSL, no explanations. Start with `root :`.

--------------------------------------------------------------------------------
RESPONSE
--------------------------------------------------------------------------------
```
root :
    selector :
        # Turn 1: Mandatory Scan
        sequence :
            condition : IsTurnEarly(1)
            task : Scan()

        # Emergency Defend
        sequence :
            condition : IsPlayerHPLow(40)
            task : Defend()

        # Aggressive Heal
        sequence :
            condition : IsPlayerHPLow(30)
            condition : CanHeal()
            task : Heal()

        # Fire Exploit
        sequence :
            condition : HasScannedEnemy()
            condition : EnemyWeakTo(Fire)
            condition : HasMP(15)
            task : FireSpell()

        # Ice Exploit
        sequence :
            condition : HasScannedEnemy()
            condition : EnemyWeakTo(Ice)
            condition : HasMP(20)
            task : IceSpell()

        # Lightning Exploit
        sequence :
            condition : HasScannedEnemy()
            condition : EnemyWeakTo(Lightning)
            condition : HasMP(20)
            condition : HasTP(20)
            task : LightningSpell()

        # Scan after Attack
        sequence :
            condition : HasMP(15)
            condition : HasScannedEnemy()
            task : Scan()

        # Power Strike if TP
        sequence :
            condition : HasTP(30)
            task : PowerStrike()

        # Default: Attack
        task : Attack()
```

================================================================================
Prompt length: 4930 chars
Response length: 1350 chars
================================================================================
