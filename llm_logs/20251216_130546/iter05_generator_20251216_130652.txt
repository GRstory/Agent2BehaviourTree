================================================================================
GENERATOR LLM LOG
Iteration: 5
Timestamp: 20251216_130652
Temperature: 0.7999999999999999
No improvement count: 3
================================================================================

--------------------------------------------------------------------------------
SYSTEM PROMPT
--------------------------------------------------------------------------------
You are an expert AI strategist specializing in turn-based RPG combat and Behaviour Tree design.

CRITICAL: The Behaviour Tree executes ONE action per turn.

AVAILABLE ACTIONS (7 total):
- Attack: Free, 9 damage, +10 MP (resource recovery!)
- Charge: 15 MP, 7 damage + next turn all damage x2
- FireSpell: 20 MP, 7 damage (1.5x when enemy has Ice element), Burn 25%
- IceSpell: 20 MP, 10 damage (1.5x when enemy has Fire element), Freeze 25%
- Defend: Free, 50% damage reduction for 1 turn
- Heal: 30 MP, +40 HP, 3 turn cooldown
- Cleanse: 25 MP, removes Burn/AttackDown, +10% damage for 1 turn

ELEMENTAL SYSTEM:
- Fire attacks deal 1.5x damage to Ice element enemies
- Ice attacks deal 1.5x damage to Fire element enemies
- Enemies start as Neutral (no weakness), can gain Fire/Ice element during combat
- **CRITICAL: Player attacks do NOT change enemy element**
- **CRITICAL: Use FireSpell when enemy HAS Ice element (Fire beats Ice!)**
- **CRITICAL: Use IceSpell when enemy HAS Fire element (Ice beats Fire!)**
- Status effects: Freeze 25%, Burn from FireGolem (10 dmg/turn × 3 turns, bypasses defense!)

ENEMY MECHANICS:
- FireGolem (HP 180, Def 5): Phase 2 (HP < 50%) gains Fire element automatically, FlameStrike adds Burn (10/turn × 3 = 30 total, bypasses defense!)
- IceWraith (HP 200, Def 8): Gains Ice element when it uses FrostBlast (3 turns), Debuff gives AttackDown -20% for 3 turns, DefensiveStance (+25% def 1 turn, +20% dmg next turn)

RESOURCES:
- MP only, regenerates 5 per turn
- Start with 100 MP
- Attack restores +10 MP (total +15 MP per turn when using Attack!)

Your expertise includes:
- Elemental weakness exploitation (1.5x damage!)
- Cleanse timing (use when Burn/AttackDown active for huge value)
- MP management (Cleanse 25, Spells 20, Heal 30)
- Telegraph defense (Defend against HeavySlam/Debuff)
- DoT awareness (Burn bypasses defense, 30 total damage!)
- **Element checking**: Use EnemyHasElement(Fire/Ice/Neutral) to check enemy's current element

Always output valid BT DSL following the specification exactly. Use 4 spaces for indentation.
You must ONLY use the control nodes (root, selector, sequence), conditions, and tasks listed in the DSL specification.

--------------------------------------------------------------------------------
USER PROMPT
--------------------------------------------------------------------------------
Generate an IMPROVED Behaviour Tree based on feedback.

# Current Behaviour Tree
```
root :
    selector :
        # Defend against FrostBlast
        condition : EnemyIsTelegraphing(Debuff)
        task : Defend()

        # Defend against HeavySlam
        condition : EnemyIsTelegraphing(HeavySlam)
        task : Defend()

        # Heal when critical
        sequence :
            condition : IsPlayerHPLow(40)
            condition : CanHeal()
            task : Heal()

        # Cleanse Burn/AttackDown
        sequence :
            selector :
                condition : HasStatus(BURN)
                condition : HasStatus(ATTACKDOWN)
            condition : HasMP(25)
            task : Cleanse()

        # FireSpell when enemy has Ice element
        sequence :
            condition : EnemyHasElement(Ice)
            condition : HasMP(20)
            task : FireSpell()

        # IceSpell when enemy has Fire element
        sequence :
            condition : EnemyHasElement(Fire)
            condition : HasMP(20)
            task : IceSpell()

        # Default: Attack
        task : Attack()
```

# Improvement Feedback
## Analysis

The combat against IceWraith was dominated by reactive defense – primarily responding to FrostTouch attacks. The player consistently defended against telegraphed attacks, but failed to proactively scan for elemental weaknesses or capitalize on the IceWraith’s FrostBlast ability. MP was used defensively, with little strategic investment in spells. The reliance on Defend without a clear elemental strategy resulted in a prolonged, low-damage fight and a 25-turn defeat. The Heal was triggered too late, and the BT didn't prioritize exploiting the IceWraith's vulnerabilities.

## Improvement Suggestions

1. **Scan on Turn 1:** Add a task to "Scan Enemy" on turn 1. This task should immediately determine the enemy’s element (Ice) and update the BT’s knowledge. This would prevent the player from wasting turns reacting to FrostTouch instead of preparing for the IceSpell.

2. **IceSpell Priority:** Modify the BT to prioritize the IceSpell when the enemy is identified as having the Ice element.  Specifically, add a condition “EnemyHasElement(Ice)” that triggers the IceSpell task.  This should override the default Attack task when Ice is detected.

3. **Heal Threshold Adjustment:** Increase the Heal trigger threshold from 40% to 60%. This would allow the player to trigger the Heal sooner, before HP drops too low and the fight becomes overwhelmingly defensive.  The 3-turn cooldown should still be maintained to prevent spamming.

4. **Defend vs. IceSpell Tradeoff:** Introduce a conditional task: "Def Ах when enemy telegraphs FrostTouch, otherwise execute IceSpell". This allows the BT to intelligently choose between reacting defensively or proactively exploiting the enemy’s weakness.

5. **MP Allocation Adjustment:**  Increase the MP cost of the IceSpell by 10%. This would force the player to make more strategic decisions about when to use it, rather than simply reacting to the enemy's actions.


# COMPLETE LIST OF AVAILABLE SYNTAX

**Control Nodes (ONLY these 3):**
- `root :` - Must be first line, has one child
- `selector :` - Tries children until one succeeds
- `sequence :` - All conditions must pass, executes final task

**Conditions (ONLY these):**
- `IsPlayerHPLow(30)` - Player HP < threshold%
- `IsEnemyHPLow(30)` - Enemy HP < threshold%
- `HasMP(20)` - Player has >= amount MP
- `CanHeal()` - Heal is off cooldown AND MP >= 30
- `EnemyHasElement(Fire)`, `EnemyHasElement(Ice)`, or `EnemyHasElement(Neutral)` - Check enemy's current element (DYNAMIC! Changes during combat)
- `EnemyHasBuff(Enrage)` - Enemy has specific buff
- `EnemyIsTelegraphing(HeavySlam)` - Enemy will execute this action THIS turn (telegraphed at end of last turn)
- `HasStatus(CHARGED)` - Player has CHARGED status (from Charge action)
- `NOT <condition>` - Negates a condition

**CRITICAL SPELL USAGE EXAMPLES:**
```
# When enemy HAS Ice element → Use FireSpell (Fire beats Ice!)
sequence :
    condition : EnemyHasElement(Ice)
    condition : HasMP(20)
    task : FireSpell()  # 1.5x damage!

# When enemy HAS Fire element → Use IceSpell (Ice beats Fire!)
sequence :
    condition : EnemyHasElement(Fire)
    condition : HasMP(20)
    task : IceSpell()  # 1.5x damage!
```

**Tasks (ONLY these 7):**
- `Attack()` - Basic attack
- `Charge()` - Charge for next turn 2x damage
- `FireSpell()` - Fire spell
- `IceSpell()` - Ice spell
- `Defend()` - Reduce damage 50%
- `Heal()` - Heal 40 HP
- `Cleanse()` - Remove debuffs

# CRITICAL RULES

3. **Indentation**: Use exactly 4 spaces per level
4. **Format**: `condition : IsPlayerHPLow(30)` and `task : Heal()`
5. **Fallback**: Always end selector with `task : Attack()`

# Your Task

Apply the feedback to create an improved BT using ONLY the syntax listed above. Output ONLY the BT DSL, no explanations. Start with `root :`.

--------------------------------------------------------------------------------
RESPONSE
--------------------------------------------------------------------------------
```
root :
    selector :
        # Defend against Debuff
        condition : EnemyIsTelegraphing(Debuff)
        task : Defend()

        # Defend against HeavySlam
        condition : EnemyIsTelegraphing(HeavySlam)
        task : Defend()

        # Heal when critical
        sequence :
            condition : IsPlayerHPLow(60)
            condition : CanHeal()
            task : Heal()

        # Cleanse Burn/AttackDown
        sequence :
            selector :
                condition : HasStatus(BURN)
                condition : HasStatus(ATTACKDOWN)
            condition : HasMP(25)
            task : Cleanse()

        # IceSpell when enemy has Fire element
        sequence :
            condition : EnemyHasElement(Fire)
            condition : HasMP(20)
            task : IceSpell()

        # IceSpell when enemy has Ice element
        sequence :
            condition : EnemyHasElement(Ice)
            condition : HasMP(20)
            task : IceSpell()

        # Default: Attack
        task : Attack()
```

================================================================================
Prompt length: 4932 chars
Response length: 1032 chars
================================================================================
