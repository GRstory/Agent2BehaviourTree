================================================================================
GENERATOR LLM LOG
Iteration: 9
Timestamp: 20251216_132200
Temperature: 0.7
No improvement count: 0
================================================================================

--------------------------------------------------------------------------------
SYSTEM PROMPT
--------------------------------------------------------------------------------
You are an expert AI strategist specializing in turn-based RPG combat and Behaviour Tree design.

CRITICAL: The Behaviour Tree executes ONE action per turn.

AVAILABLE ACTIONS (7 total):
- Attack: Free, 9 damage, +10 MP (resource recovery!)
- Charge: 15 MP, 7 damage + next turn all damage x2
- FireSpell: 20 MP, 7 damage (1.5x when enemy has Ice element), Burn 25%
- IceSpell: 20 MP, 10 damage (1.5x when enemy has Fire element), Freeze 25%
- Defend: Free, 50% damage reduction for 1 turn
- Heal: 30 MP, +40 HP, 3 turn cooldown
- Cleanse: 25 MP, removes Burn/AttackDown, +10% damage for 1 turn

ELEMENTAL SYSTEM:
- Fire attacks deal 1.5x damage to Ice element enemies
- Ice attacks deal 1.5x damage to Fire element enemies
- Enemies start as Neutral (no weakness), can gain Fire/Ice element during combat
- **CRITICAL: Player attacks do NOT change enemy element**
- **CRITICAL: Use FireSpell when enemy HAS Ice element (Fire beats Ice!)**
- **CRITICAL: Use IceSpell when enemy HAS Fire element (Ice beats Fire!)**
- Status effects: Freeze 25%, Burn from FireGolem (10 dmg/turn × 3 turns, bypasses defense!)

ENEMY MECHANICS:
- FireGolem (HP 180, Def 5): Phase 2 (HP < 50%) gains Fire element automatically, FlameStrike adds Burn (10/turn × 3 = 30 total, bypasses defense!)
- IceWraith (HP 200, Def 8): Gains Ice element when it uses FrostBlast (3 turns), Debuff gives AttackDown -20% for 3 turns, DefensiveStance (+25% def 1 turn, +20% dmg next turn)

RESOURCES:
- MP only, regenerates 5 per turn
- Start with 100 MP
- Attack restores +10 MP (total +15 MP per turn when using Attack!)

Your expertise includes:
- Elemental weakness exploitation (1.5x damage!)
- Cleanse timing (use when Burn/AttackDown active for huge value)
- MP management (Cleanse 25, Spells 20, Heal 30)
- Telegraph defense (Defend against HeavySlam/Debuff)
- DoT awareness (Burn bypasses defense, 30 total damage!)
- **Element checking**: Use EnemyHasElement(Fire/Ice/Neutral) to check enemy's current element

Always output valid BT DSL following the specification exactly. Use 4 spaces for indentation.
You must ONLY use the control nodes (root, selector, sequence), conditions, and tasks listed in the DSL specification.

--------------------------------------------------------------------------------
USER PROMPT
--------------------------------------------------------------------------------
Generate an IMPROVED Behaviour Tree based on feedback.

# Current Behaviour Tree
```
root :
    selector :
        # Defend against HeavySlam/FrostBlast
        sequence :
            condition : EnemyIsTelegraphing(HeavySlam)
            task : Defend()
        sequence :
            condition : EnemyIsTelegraphing(FrostBlast)
            task : Defend()

        # Heal when critical
        sequence :
            condition : IsPlayerHPLow(40)
            condition : CanHeal()
            task : Heal()

        # Cleanse Burn/AttackDown
        sequence :
            condition : HasStatus(BURN)
            condition : HasMP(25)
            task : Cleanse()
        sequence :
            condition : HasStatus(ATTACK_DOWN)
            condition : HasMP(25)
            task : Cleanse()

        # Ice spell when enemy has fire
        sequence :
            condition : EnemyHasElement(Fire)
            condition : HasMP(20)
            task : IceSpell()

        # Fire spell when enemy has ice
        sequence :
            condition : EnemyHasElement(Ice)
            condition : HasMP(20)
            task : FireSpell()

        # Prioritize Attack when low MP
        sequence :
            condition : NOT HasMP(40)
            task : Attack()
            
        # Default: Attack
        task : Attack()
```

# Improvement Feedback
 Gorgeous! Let's break down this combat and craft some targeted BT improvements.

## Analysis

The primary issue in this combat was a failure to consistently react to the FireGolem’s telegraphed HeavySlam attacks. The BT prioritized attacking immediately, neglecting the defensive opportunity presented by the telegraph.  Furthermore, the BT didn’t scan the enemy, meaning it didn’t identify the FireGolem’s element, leading to ineffective spell usage. Finally, the Heal was used too late, after the enemy had sustained significant damage.

## Improvement Suggestions

1. **Implement Telegraph Defense:** “Add Defend() when enemy telegraphs HeavySlam. Prioritize this action over attacking for the first 3 turns after a telegraph.” (This directly addresses the missed defensive opportunity.)

2. **Mandatory Scan on Turn 1:** “Modify the BT to automatically initiate a scan of the enemy on turn 1. If the enemy is identified as Fire, use IceSpell on subsequent turns.” (This ensures the BT recognizes the enemy’s element and utilizes the correct spell.)

3. **Adjust Heal Threshold:** “Increase the Heal threshold from 30% to 40%.  The Heal should be triggered when the player’s HP drops below 40% instead of 30%.” (This allows for a more proactive response to damage, preventing the player from being critically low before healing.)


# COMPLETE LIST OF AVAILABLE SYNTAX

**Control Nodes (ONLY these 3):**
- `root :` - Must be first line, has one child
- `selector :` - Tries children until one succeeds
- `sequence :` - All conditions must pass, executes final task

**Conditions (ONLY these):**
- `IsPlayerHPLow(30)` - Player HP < threshold%
- `IsEnemyHPLow(30)` - Enemy HP < threshold%
- `HasMP(20)` - Player has >= amount MP
- `CanHeal()` - Heal is off cooldown AND MP >= 30
- `EnemyHasElement(Fire)`, `EnemyHasElement(Ice)`, or `EnemyHasElement(Neutral)` - Check enemy's current element (DYNAMIC! Changes during combat)
- `EnemyHasBuff(Enrage)` - Enemy has specific buff
- `EnemyIsTelegraphing(HeavySlam)` - Enemy will execute this action THIS turn (telegraphed at end of last turn)
- `HasStatus(CHARGED)` - Player has CHARGED status (from Charge action)
- `NOT <condition>` - Negates a condition

**CRITICAL SPELL USAGE EXAMPLES:**
```
# When enemy HAS Ice element → Use FireSpell (Fire beats Ice!)
sequence :
    condition : EnemyHasElement(Ice)
    condition : HasMP(20)
    task : FireSpell()  # 1.5x damage!

# When enemy HAS Fire element → Use IceSpell (Ice beats Fire!)
sequence :
    condition : EnemyHasElement(Fire)
    condition : HasMP(20)
    task : IceSpell()  # 1.5x damage!
```

**Tasks (ONLY these 7):**
- `Attack()` - Basic attack
- `Charge()` - Charge for next turn 2x damage
- `FireSpell()` - Fire spell
- `IceSpell()` - Ice spell
- `Defend()` - Reduce damage 50%
- `Heal()` - Heal 40 HP
- `Cleanse()` - Remove debuffs

# CRITICAL RULES

3. **Indentation**: Use exactly 4 spaces per level
4. **Format**: `condition : IsPlayerHPLow(30)` and `task : Heal()`
5. **Fallback**: Always end selector with `task : Attack()`

# Your Task

Apply the feedback to create an improved BT using ONLY the syntax listed above. Output ONLY the BT DSL, no explanations. Start with `root :`.

--------------------------------------------------------------------------------
RESPONSE
--------------------------------------------------------------------------------
```
root :
    selector :
        # Defend against HeavySlam/FrostBlast
        sequence :
            condition : EnemyIsTelegraphing(HeavySlam)
            task : Defend()
        sequence :
            condition : EnemyIsTelegraphing(FrostBlast)
            task : Defend()

        # Heal when critical
        sequence :
            condition : IsPlayerHPLow(40)
            condition : CanHeal()
            task : Heal()

        # Cleanse Burn/AttackDown
        sequence :
            condition : HasStatus(BURN)
            condition : HasMP(25)
            task : Cleanse()
        sequence :
            condition : HasStatus(ATTACK_DOWN)
            condition : HasMP(25)
            task : Cleanse()

        # Ice spell when enemy has fire
        sequence :
            condition : EnemyHasElement(Fire)
            condition : HasMP(20)
            task : IceSpell()

        # Fire spell when enemy has ice
        sequence :
            condition : EnemyHasElement(Ice)
            condition : HasMP(20)
            task : FireSpell()

        # Prioritize Attack when low MP
        sequence :
            condition : NOT HasMP(40)
            task : Attack()
            
        # Default: Attack
        task : Attack()
```

================================================================================
Prompt length: 4549 chars
Response length: 1246 chars
================================================================================
