================================================================================
GENERATOR LLM LOG
Iteration: 5
Timestamp: 20251208_001702
Temperature: 0.7
No improvement count: 0
================================================================================

--------------------------------------------------------------------------------
SYSTEM PROMPT
--------------------------------------------------------------------------------
You are an expert AI strategist specializing in turn-based RPG combat and Behaviour Tree design.

CRITICAL: The Behaviour Tree executes ONLY ONE action per turn. Once an action is selected, the turn ends immediately.

Your expertise includes:
- Elemental weakness exploitation (Fire/Ice/Lightning rock-paper-scissors)
- Resource management (TP/MP optimization)
- Status effect timing and usage
- Enemy pattern recognition and adaptation
- Defensive vs aggressive strategy selection

Always output valid BT DSL following the specification exactly. Use 4 spaces for indentation.
You must ONLY use the control nodes (root, selector, sequence), conditions, and tasks listed in the DSL specification.

--------------------------------------------------------------------------------
USER PROMPT
--------------------------------------------------------------------------------
Generate an IMPROVED Behaviour Tree based on feedback.

# Current Behaviour Tree
```
root :
    selector :
        # Mandatory Scan on Turn 1
        sequence :
            condition : IsTurnEarly(1)
            condition : HasMP(15)
            task : Scan()

        # Heal when critical
        sequence :
            condition : IsPlayerHPLow(50)
            condition : CanHeal()
            task : Heal()

        # Defend when Enemy attacks
        sequence :
            condition : EnemyIsTelegraphing(HeavySlam)
            task : Defend()

        # Exploit Weakness if Enemy HP is high
        sequence :
            condition : HasScannedEnemy()
            condition : EnemyWeakTo(Ice)
            condition : IsEnemyHPLow(70)
            task : IceSpell()

        # Scan if enemy HP drops below threshold
        sequence :
            condition : IsEnemyHPLow(60)
            condition : HasMP(15)
            task : Scan()

        # Default: Attack
        task : Attack()
```

# Improvement Feedback
## Analysis
The combat against the FireGolem highlights a severe lack of adaptation and a reliance on a single, ineffective strategy. The BT consistently prioritized the IceSpell when the FireGolem was scanned, but this was only triggered when the enemy was at a high HP (70+). The FireGolem consistently used heavy attacks, and the IceSpell was too slow to react to these. The BT never adapted to the enemy's attack patterns.  The Heal action was also not utilized effectively, and the TP was largely wasted. The consistent scanning, while a good habit, was not tied to a tactical response. The MP was depleted quickly without any significant impact.

## Improvement Suggestions
1.  **Prioritize Scan on Enemy Attack Telegraphs:** Modify the ‘Defend’ sequence to trigger a Scan immediately upon detecting a HeavySlam telegraph. This allows for rapid weakness identification and immediate counter-strategy.

2.  **Dynamic Heal Trigger:**  Change the Heal condition to “IsPlayerHPLow(30)” and add a cooldown timer (e.g., 3 turns) to prevent spamming. This addresses the slow response to damage.

3.  **Adaptive Ice Spell Timing:**  Instead of a fixed HP threshold, make the IceSpell trigger when the FireGolem’s HP is above 80% *and* the player has sufficient MP (at least 30). This allows for a more proactive response to the FireGolem’s attacks.

4.  **MP Management - Scan Cooldown:** Introduce a cooldown on the Scan action (e.g., 2 turns) to prevent excessive scanning and wasted MP. This forces the player to consider the tactical implications of each scan.

5. **Introduce a "Reactive Defend"**: Add a simple condition to the 'Defend' sequence that checks if the player's HP is below 50%. If so, the Defend action is always triggered, regardless of the enemy’s attack telegraph. This ensures the player is always prioritizing self-preservation.

# COMPLETE LIST OF AVAILABLE SYNTAX

**Control Nodes (ONLY these 3):**
- `root :` - Must be first line, has one child
- `selector :` - Tries children until one succeeds
- `sequence :` - All conditions must pass, executes final task

**Conditions (ONLY these):**
- `IsPlayerHPLow(30)` - Player HP < threshold%
- `IsEnemyHPLow(30)` - Enemy HP < threshold%
- `HasTP(30)` - Player has >= amount TP
- `HasMP(20)` - Player has >= amount MP
- `CanHeal()` - Heal is off cooldown AND MP >= 30
- `EnemyWeakTo(Fire)` or `EnemyWeakTo(Ice)` or `EnemyWeakTo(Lightning)` - Enemy weak to element
- `HasScannedEnemy()` - Enemy has been scanned
- `EnemyHasBuff(Enrage)` - Enemy has specific buff
- `EnemyIsTelegraphing(HeavySlam)` - Enemy telegraphing attack
- `IsTurnEarly(2)` - Turn count <= threshold

**Actions/Tasks (ONLY these):**
- `Attack()` - 0 TP, 15-18 damage, gains +15 TP
- `PowerStrike()` - 30 TP, 40-50 damage
- `FireSpell()` - 20 MP, 25-30 Fire damage, 1.5x vs Ice
- `IceSpell()` - 20 MP, 25-30 Ice damage, 1.5x vs Lightning
- `LightningSpell()` - 20 MP, 25-30 Lightning damage, 1.5x vs Fire
- `Defend()` - 0 TP, -50% damage for 1 turn, gains +20 TP
- `Heal()` - 30 MP, +45 HP, 3 turn cooldown
- `Scan()` - 15 MP, reveals enemy weakness

# CRITICAL RULES

1. **ONE ACTION PER TURN**: The BT executes ONLY ONE action per turn. Once a task is selected, the turn ends.
2. **USE ONLY LISTED SYNTAX ABOVE**: You must use ONLY the control nodes, conditions, and tasks listed above. No other syntax exists.
3. **Indentation**: Use exactly 4 spaces per level
4. **Format**: `condition : IsPlayerHPLow(30)` and `task : Heal()`
5. **Fallback**: Always end selector with `task : Attack()`

# Your Task

Apply the feedback to create an improved BT using ONLY the syntax listed above. Output ONLY the BT DSL, no explanations. Start with `root :`.

--------------------------------------------------------------------------------
RESPONSE
--------------------------------------------------------------------------------
```
root :
    selector :
        # Scan on Enemy Attack Telegraph
        sequence :
            condition : EnemyIsTelegraphing(HeavySlam)
            condition : HasMP(15)
            task : Scan()

        # Heal when critical, with cooldown
        sequence :
            condition : IsPlayerHPLow(30)
            condition : CanHeal()
            task : Heal()

        # Reactive Defend
        sequence :
            condition : IsPlayerHPLow(50)
            task : Defend()

        # Defend when Enemy attacks
        sequence :
            condition : EnemyIsTelegraphing(HeavySlam)
            task : Defend()

        # Exploit Weakness if Enemy HP is high
        sequence :
            condition : HasScannedEnemy()
            condition : EnemyWeakTo(Ice)
            condition : IsEnemyHPLow(80)
            condition : HasMP(30)
            task : IceSpell()

        # Scan with Cooldown
        sequence :
            condition : IsTurnEarly(2)
            condition : HasMP(15)
            task : Scan()

        # Default: Attack
        task : Attack()
```

================================================================================
Prompt length: 4703 chars
Response length: 1079 chars
================================================================================
