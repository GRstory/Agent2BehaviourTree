================================================================================
GENERATOR LLM LOG
Iteration: 21
Timestamp: 20251216_125807
Temperature: 1.2
No improvement count: 11
================================================================================

--------------------------------------------------------------------------------
SYSTEM PROMPT
--------------------------------------------------------------------------------
You are an expert AI strategist specializing in turn-based RPG combat and Behaviour Tree design.

CRITICAL: The Behaviour Tree executes ONE action per turn.

AVAILABLE ACTIONS (7 total):
- Attack: Free, 9 damage, +10 MP (resource recovery!)
- Charge: 15 MP, 7 damage + next turn all damage x2
- FireSpell: 20 MP, 7 damage (1.5x when enemy has Ice element), Burn 25%
- IceSpell: 20 MP, 10 damage (1.5x when enemy has Fire element), Freeze 25%
- Defend: Free, 50% damage reduction for 1 turn
- Heal: 30 MP, +40 HP, 3 turn cooldown
- Cleanse: 25 MP, removes Burn/AttackDown, +10% damage for 1 turn

ELEMENTAL SYSTEM:
- Fire attacks deal 1.5x damage to Ice element enemies
- Ice attacks deal 1.5x damage to Fire element enemies
- Enemies start as Neutral (no weakness), can gain Fire/Ice element during combat
- **CRITICAL: Player attacks do NOT change enemy element**
- **CRITICAL: Use FireSpell when enemy HAS Ice element (Fire beats Ice!)**
- **CRITICAL: Use IceSpell when enemy HAS Fire element (Ice beats Fire!)**
- Status effects: Freeze 25%, Burn from FireGolem (10 dmg/turn × 3 turns, bypasses defense!)

ENEMY MECHANICS:
- FireGolem (HP 180, Def 5): Phase 2 (HP < 50%) gains Fire element automatically, FlameStrike adds Burn (10/turn × 3 = 30 total, bypasses defense!)
- IceWraith (HP 200, Def 8): Gains Ice element when it uses FrostBlast (3 turns), Debuff gives AttackDown -20% for 3 turns, DefensiveStance (+25% def 1 turn, +20% dmg next turn)

RESOURCES:
- MP only, regenerates 5 per turn
- Start with 100 MP
- Attack restores +10 MP (total +15 MP per turn when using Attack!)

Your expertise includes:
- Elemental weakness exploitation (1.5x damage!)
- Cleanse timing (use when Burn/AttackDown active for huge value)
- MP management (Cleanse 25, Spells 20, Heal 30)
- Telegraph defense (Defend against HeavySlam/Debuff)
- DoT awareness (Burn bypasses defense, 30 total damage!)
- **Element checking**: Use EnemyHasElement(Fire/Ice/Neutral) to check enemy's current element

Always output valid BT DSL following the specification exactly. Use 4 spaces for indentation.
You must ONLY use the control nodes (root, selector, sequence), conditions, and tasks listed in the DSL specification.

--------------------------------------------------------------------------------
USER PROMPT
--------------------------------------------------------------------------------
Generate an IMPROVED Behaviour Tree based on feedback.

# Current Behaviour Tree
```
root :
    selector :
        # Highest Priority: Defend against telegraphed attacks
        sequence :
            condition : EnemyIsTelegraphing(HeavySlam)
            task : Defend()
        sequence :
            condition : EnemyIsTelegraphing(Debuff)
            task : Defend()
        sequence :
            condition : EnemyIsTelegraphing(FrostBlast)
            task : Defend()

        # Exploit elemental weakness
        selector :
            sequence :
                condition : EnemyHasElement(Ice)
                condition : HasMP(20)
                task : FireSpell()
            sequence :
                condition : EnemyHasElement(Fire)
                condition : HasMP(20)
                task : IceSpell()
            sequence :
                condition : EnemyHasElement(Neutral)
                condition : HasMP(20)
                task : IceSpell()

        # FireGolem HP Watch
        sequence :
            condition : IsEnemyHPLow(90)
            condition : EnemyHasElement(Neutral)
            condition : HasMP(20)
            task : IceSpell()

        # Heal when critical
        sequence :
            condition : IsPlayerHPLow(60)
            condition : CanHeal()
            task : Heal()

        # Cleanse AttackDown/Burn
        sequence :
            condition : HasStatus(AttackDown)
            condition : HasMP(25)
            task : Cleanse()
        sequence :
            condition : HasStatus(Burn)
            condition : HasMP(25)
            task : Cleanse()

        # Replenish MP with Attack
        sequence :
            condition : HasMP(15)
            task : Attack()

        # Default: Attack
        task : Attack()
```

# Improvement Feedback
## Analysis

The combat highlights several key issues with the BT’s strategy against FireGolem. Primarily, the BT failed to consistently react to the heavily telegraphed HeavySlam attacks, resulting in significant damage taken. The BT also didn't effectively utilize the enemy’s eventual Fire element, failing to capitalize on the 1.5x damage bonus. Finally, MP management was suboptimal, leading to a premature end to the combat.

## Improvement Suggestions

1. **Prioritize HeavySlam Defense:** Add a condition to the main sequence that *immediately* triggers `Defend()` when the enemy telegraphs `HeavySlam`. This should be the *highest* priority action, overriding other options. This will dramatically reduce damage taken during the initial telegraph.

2. **Elemental Scanning on Turn 1:** Add a task on turn 1 that *immediately* scans the enemy. If the scan reveals Fire, immediately cast `IceSpell`. This proactive approach would have prevented the critical damage taken during the FireGolem’s phase 2.

3. **Adjust Heal Threshold:** Increase the HP threshold for using the `Heal()` ability from 30% to 40%. The BT consistently healed at 9% HP, which is far too late. Waiting until HP is only 40% significantly reduces the effectiveness of the heal and wastes valuable turns.

4. **MP Prioritization:** Modify the MP allocation. If MP is above 60, prioritize casting `IceSpell` (if enemy is Fire) or `IceSpell` (if enemy is Neutral) over `Attack`. This ensures MP isn't wasted on ineffective attacks when a powerful spell is available.

5. **Add a "Telegraph Confirmation" Task:** Add a task that checks if the HeavySlam telegraph is *confirmed* (i.e., the enemy actually performs the attack). This prevents the BT from wasting a defensive turn if the telegraph is simply a false alarm.


# COMPLETE LIST OF AVAILABLE SYNTAX

**Control Nodes (ONLY these 3):**
- `root :` - Must be first line, has one child
- `selector :` - Tries children until one succeeds
- `sequence :` - All conditions must pass, executes final task

**Conditions (ONLY these):**
- `IsPlayerHPLow(30)` - Player HP < threshold%
- `IsEnemyHPLow(30)` - Enemy HP < threshold%
- `HasMP(20)` - Player has >= amount MP
- `CanHeal()` - Heal is off cooldown AND MP >= 30
- `EnemyHasElement(Fire)`, `EnemyHasElement(Ice)`, or `EnemyHasElement(Neutral)` - Check enemy's current element (DYNAMIC! Changes during combat)
- `EnemyHasBuff(Enrage)` - Enemy has specific buff
- `EnemyIsTelegraphing(HeavySlam)` - Enemy will execute this action THIS turn (telegraphed at end of last turn)
- `HasStatus(CHARGED)` - Player has CHARGED status (from Charge action)
- `NOT <condition>` - Negates a condition

**CRITICAL SPELL USAGE EXAMPLES:**
```
# When enemy HAS Ice element → Use FireSpell (Fire beats Ice!)
sequence :
    condition : EnemyHasElement(Ice)
    condition : HasMP(20)
    task : FireSpell()  # 1.5x damage!

# When enemy HAS Fire element → Use IceSpell (Ice beats Fire!)
sequence :
    condition : EnemyHasElement(Fire)
    condition : HasMP(20)
    task : IceSpell()  # 1.5x damage!
```

**Actions/Tasks (ONLY these):**
- `Attack()` - Free, 9 damage, +10 MP (resource recovery!)
- `Charge()` - 15 MP, 7 damage + next turn all damage x2
- `FireSpell()` - 20 MP, 7 damage, 1.5x when enemy has Ice element
- `IceSpell()` - 20 MP, 10 damage, 1.5x when enemy has Fire element
- `Defend()` - Free, 50% damage reduction for 1 turn
- `Heal()` - 30 MP, +40 HP, 3 turn cooldown
- `Cleanse()` - 25 MP, removes Burn/AttackDown, +10% damage 1 turn

# CRITICAL RULES

1. **ONE ACTION PER TURN**: The BT executes ONLY ONE action per turn. Once a task is selected, the turn ends.
2. **USE ONLY LISTED SYNTAX ABOVE**: You must use ONLY the control nodes, conditions, and tasks listed above. No other syntax exists.
3. **Indentation**: Use exactly 4 spaces per level
4. **Format**: `condition : IsPlayerHPLow(30)` and `task : Heal()`
5. **Fallback**: Always end selector with `task : Attack()`

# Your Task

Apply the feedback to create an improved BT using ONLY the syntax listed above. Output ONLY the BT DSL, no explanations. Start with `root :`.

--------------------------------------------------------------------------------
RESPONSE
--------------------------------------------------------------------------------
```
root :
    selector :
        # Highest Priority: Defend against telegraphed attacks
        sequence :
            condition : EnemyIsTelegraphing(HeavySlam)
            task : Defend()
        sequence :
            condition : EnemyIsTelegraphing(Debuff)
            task : Defend()
        sequence :
            condition : EnemyIsTelegraphing(FrostBlast)
            task : Defend()

        # Exploit elemental weakness
        selector :
            sequence :
                condition : EnemyHasElement(Ice)
                condition : HasMP(20)
                task : FireSpell()
            sequence :
                condition : EnemyHasElement(Fire)
                condition : HasMP(20)
                task : IceSpell()
            sequence :
                condition : EnemyHasElement(Neutral)
                condition : HasMP(20)
                task : IceSpell()

        # FireGolem HP Watch
        sequence :
            condition : IsEnemyHPLow(90)
            condition : EnemyHasElement(Neutral)
            condition : HasMP(20)
            task : IceSpell()

        # Heal when critical
        sequence :
            condition : IsPlayerHPLow(40)
            condition : CanHeal()
            task : Heal()

        # Cleanse AttackDown/Burn
        sequence :
            condition : HasStatus(AttackDown)
            condition : HasMP(25)
            task : Cleanse()
        sequence :
            condition : HasStatus(Burn)
            condition : HasMP(25)
            task : Cleanse()

        # Prioritize IceSpell if sufficient MP and enemy is Fire or Neutral
        selector :
            sequence :
                condition : EnemyHasElement(Fire)
                condition : HasMP(60)
                task : IceSpell()
            sequence :
                condition : EnemyHasElement(Neutral)
                condition : HasMP(60)
                task : IceSpell()

        # Replenish MP with Attack
        sequence :
            condition : HasMP(15)
            task : Attack()

        # Default: Attack
        task : Attack()
```

================================================================================
Prompt length: 5908 chars
Response length: 2087 chars
================================================================================
