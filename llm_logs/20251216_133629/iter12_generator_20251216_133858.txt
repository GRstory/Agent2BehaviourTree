================================================================================
GENERATOR LLM LOG
Iteration: 12
Timestamp: 20251216_133858
Temperature: 1.2
No improvement count: 11
================================================================================

--------------------------------------------------------------------------------
SYSTEM PROMPT
--------------------------------------------------------------------------------
You are an expert AI strategist specializing in turn-based RPG combat and Behaviour Tree design.

CRITICAL: The Behaviour Tree executes ONE action per turn.

AVAILABLE ACTIONS (7 total):
- Attack: Free, 9 damage, +10 MP (resource recovery!)
- Charge: 15 MP, 7 damage + next turn all damage x2
- FireSpell: 20 MP, 7 damage (1.5x when enemy has Ice element), Burn 25%
- IceSpell: 20 MP, 10 damage (1.5x when enemy has Fire element), Freeze 25%
- Defend: Free, 50% damage reduction for 1 turn
- Heal: 30 MP, +40 HP, 3 turn cooldown
- Cleanse: 25 MP, removes Burn/AttackDown, +10% damage for 1 turn

ELEMENTAL SYSTEM:
- Fire attacks deal 1.5x damage to Ice element enemies
- Ice attacks deal 1.5x damage to Fire element enemies
- Enemies start as Neutral (no weakness), can gain Fire/Ice element during combat
- **CRITICAL: Player attacks do NOT change enemy element**
- **CRITICAL: Use FireSpell when enemy HAS Ice element (Fire beats Ice!)**
- **CRITICAL: Use IceSpell when enemy HAS Fire element (Ice beats Fire!)**
- Status effects: Freeze 25%, Burn from FireGolem (10 dmg/turn × 3 turns, bypasses defense!)

ENEMY MECHANICS:
- FireGolem (HP 180, Def 5): Phase 2 (HP < 50%) gains Fire element automatically, FlameStrike adds Burn (10/turn × 3 = 30 total, bypasses defense!)
- IceWraith (HP 200, Def 8): Gains Ice element when it uses FrostBlast (3 turns), Debuff gives AttackDown -20% for 3 turns, DefensiveStance (+25% def 1 turn, +20% dmg next turn)

RESOURCES:
- MP only, regenerates 5 per turn
- Start with 100 MP
- Attack restores +10 MP (total +15 MP per turn when using Attack!)

Your expertise includes:
- Elemental weakness exploitation (1.5x damage!)
- Cleanse timing (use when Burn/AttackDown active for huge value)
- MP management (Cleanse 25, Spells 20, Heal 30)
- Telegraph defense (Defend against HeavySlam/Debuff)
- DoT awareness (Burn bypasses defense, 30 total damage!)
- **Element checking**: Use EnemyHasElement(Fire/Ice/Neutral) to check enemy's current element

Always output valid BT DSL following the specification exactly. Use 4 spaces for indentation.
You must ONLY use the control nodes (root, selector, sequence), conditions, and tasks listed in the DSL specification.

--------------------------------------------------------------------------------
USER PROMPT
--------------------------------------------------------------------------------
Generate an IMPROVED Behaviour Tree based on feedback.

# Current Behaviour Tree
```
root :
    selector :
        # Defend against HeavySlam
        sequence :
            condition : EnemyIsTelegraphing(HeavySlam)
            task : Defend()

        # Defend against FrostBlast
        sequence :
            condition : EnemyIsTelegraphing(FrostBlast)
            task : Defend()

        # IceSpell when enemy has Fire
        sequence :
            condition : EnemyHasElement(Fire)
            condition : HasMP(20)
            task : IceSpell()

        # FireSpell when enemy has Ice
        sequence :
            condition : EnemyHasElement(Ice)
            condition : HasMP(20)
            task : FireSpell()

        # Heal when HP is low
        sequence :
            condition : IsPlayerHPLow(50)
            condition : CanHeal()
            task : Heal()

        # Cleanse when Burn/AttackDown is active
        sequence :
            condition : HasStatus(Burn)
            condition : HasMP(25)
            task : Cleanse()

        sequence :
            condition : HasStatus(AttackDown)
            condition : HasMP(25)
            task : Cleanse()

        # Attack when low on MP
        sequence :
            condition : NOT HasMP(20)
            task : Attack()

        # Default: Attack
        task : Attack()
```

# Improvement Feedback
## Analysis

The combat against IceWraith highlighted several key issues with the BT’s strategy and resource management. Primarily, the BT failed to adequately react to the telegraphed FrostBlast attacks, leading to significant HP loss. Secondly, the BT didn’t consistently utilize the Ice element vulnerability, opting for FireSpell when IceSpell would have been far more effective. Finally, the BT’s healing strategy was too conservative, prioritizing full HP recovery over proactive defense against the enemy’s aggressive attacks. The MP usage was also suboptimal, with the BT not prioritizing offensive spells when they were available.

## Improvement Suggestions

1. **Telegraph Defense:** Add Defend() when enemy telegraphs FrostBlast. This should be the highest priority, as FrostBlast was consistently a devastating attack. The BT needs to recognize the telegraph and immediately activate the defense to mitigate the damage.

2. **Elemental Scanning & Spell Selection:** Add a “Scan Enemy Element” task on turn 1. If the enemy is neutral, this task will immediately trigger an IceSpell. If the enemy is already Ice, then continue with the existing IceSpell strategy. This addresses the critical error of using FireSpell when IceSpell would have been far more effective.

3. **Aggressive Healing Threshold:** Adjust the Heal trigger from 50% to 40%. The current 50% threshold resulted in the BT waiting until HP was dangerously low before initiating a heal, allowing the enemy to inflict more damage.  Lowering the threshold will promote more proactive healing and reduce the impact of the enemy’s attacks.

4. **Prioritize MP for Offensive Spells:** Modify the BT to prioritize casting spells (IceSpell/FireSpell) when MP is available, instead of defaulting to Attack. This will ensure the BT capitalizes on its elemental advantage.

5. **Implement a "Telegraph Confirmation" Condition**: Add a condition to the Defend action that checks if the enemy is telegraphing an attack (FrostBlast). This will ensure that Defend is only activated when it’s actually needed, preventing wasted turns.


# COMPLETE LIST OF AVAILABLE SYNTAX

**Control Nodes (ONLY these 3):**
- `root :` - Must be first line, has one child
- `selector :` - Tries children until one succeeds
- `sequence :` - All conditions must pass, executes final task

**Conditions (ONLY these):**
- `IsPlayerHPLow(30)` - Player HP < threshold%
- `IsEnemyHPLow(30)` - Enemy HP < threshold%
- `HasMP(20)` - Player has >= amount MP
- `CanHeal()` - Heal is off cooldown AND MP >= 30
- `EnemyHasElement(Fire)`, `EnemyHasElement(Ice)`, or `EnemyHasElement(Neutral)` - Check enemy's current element (DYNAMIC! Changes during combat)
- `EnemyHasBuff(Enrage)` - Enemy has specific buff
- `EnemyIsTelegraphing(HeavySlam)` - Enemy will execute this action THIS turn (telegraphed at end of last turn)
- `HasStatus(CHARGED)` - Player has CHARGED status (from Charge action)
- `NOT <condition>` - Negates a condition

**CRITICAL SPELL USAGE EXAMPLES:**
```
# When enemy HAS Ice element → Use FireSpell (Fire beats Ice!)
sequence :
    condition : EnemyHasElement(Ice)
    condition : HasMP(20)
    task : FireSpell()  # 1.5x damage!

# When enemy HAS Fire element → Use IceSpell (Ice beats Fire!)
sequence :
    condition : EnemyHasElement(Fire)
    condition : HasMP(20)
    task : IceSpell()  # 1.5x damage!
```

**Tasks (ONLY these 7):**
- `Attack()` - Basic attack
- `Charge()` - Charge for next turn 2x damage
- `FireSpell()` - Fire spell
- `IceSpell()` - Ice spell
- `Defend()` - Reduce damage 50%
- `Heal()` - Heal 40 HP
- `Cleanse()` - Remove debuffs

# CRITICAL RULES

3. **Indentation**: Use exactly 4 spaces per level
4. **Format**: `condition : IsPlayerHPLow(30)` and `task : Heal()`
5. **Fallback**: Always end selector with `task : Attack()`

# Your Task

Apply the feedback to create an improved BT using ONLY the syntax listed above. Output ONLY the BT DSL, no explanations. Start with `root :`.

--------------------------------------------------------------------------------
RESPONSE
--------------------------------------------------------------------------------
```
root :
    selector :
        # Defend against FrostBlast
        sequence :
            condition : EnemyIsTelegraphing(FrostBlast)
            task : Defend()

        # IceSpell when enemy has Fire
        sequence :
            condition : EnemyHasElement(Fire)
            condition : HasMP(20)
            task : IceSpell()

        # FireSpell when enemy has Ice
        sequence :
            condition : EnemyHasElement(Ice)
            condition : HasMP(20)
            task : FireSpell()

        # Heal when HP is low
        sequence :
            condition : IsPlayerHPLow(40)
            condition : CanHeal()
            task : Heal()

        # Cleanse when Burn/AttackDown is active
        sequence :
            condition : HasStatus(Burn)
            condition : HasMP(25)
            task : Cleanse()

        sequence :
            condition : HasStatus(AttackDown)
            condition : HasMP(25)
            task : Cleanse()

        # IceSpell when no elemental advantage but sufficient MP
        sequence :
            condition : EnemyHasElement(Neutral)
            condition : HasMP(20)
            task : IceSpell()

        # Attack when low on MP
        sequence :
            condition : NOT HasMP(20)
            task : Attack()

        # Default: Attack
        task : Attack()
```

================================================================================
Prompt length: 5333 chars
Response length: 1326 chars
================================================================================
