# 게임 메커니즘 변경 사항

## 변경된 내용

### 1. 방어 (Defend)
**이전**: 방어력 +10 보너스  
**변경**: 받는 데미지 50% 감소

- 방어 시 `is_defending = True` 설정
- 적의 공격 데미지 계산 후 50%로 감소
- 턴 종료 시 자동으로 리셋

### 2. 힐 (Heal)
**이전**: 고정 30 HP 회복, 3턴 쿨다운  
**변경**: 최대 HP의 25% 회복 (기본 25 HP), 층당 1번 제한

- `heal_cooldown` 제거
- `heal_used_this_floor` 추가 (Boolean)
- 새 층 시작 시 자동으로 리셋되어 다시 사용 가능

## 수정된 파일

### 게임 엔진
- `TextGame/game_engine.py`
  - `GameState`: `heal_cooldown` → `heal_used_this_floor`
  - `CombatEngine.HEAL_PERCENTAGE = 0.25` (25%)
  - `CombatEngine.DEFEND_DAMAGE_REDUCTION = 0.5` (50%)
  - 방어 메커니즘 변경: 데미지 계산 후 50% 감소 적용

### BT 노드
- `TextGame/bt_nodes.py`
  - `CanHeal`: `heal_cooldown == 0` → `not heal_used_this_floor`

### 출력 및 로깅
- `runner.py`
  - 힐 상태 표시: "쿨다운" → "이번 층에서 사용함"
  - 힐 실패 메시지: "실패 (쿨다운)" → "실패 (이미 사용함)"

### 문서
- `TextGame/bt_dsl_spec.md`
  - 방어 설명 업데이트
  - 힐 설명 업데이트
  - CanHeal 조건 설명 업데이트

- `README.md`
  - 게임 규칙 섹션 업데이트

- `TextGame/prompts.py`
  - LLM 프롬프트의 게임 규칙 설명 업데이트
  - 턴 제한 (30턴) 패배 조건 추가

## 검증 완료

테스트 결과:
- ✅ 힐: 25 HP 회복 (최대 HP의 25%)
- ✅ 힐 제한: 층당 1번만 사용 가능
- ✅ 층 리셋: 새 층에서 힐 다시 사용 가능
- ✅ 방어: 데미지 약 50% 감소 (7 → 3)

## 게임 밸런스 영향

### 힐 변경
- **장점**: 층당 1번만 사용 가능하므로 전략적 타이밍이 중요
- **단점**: 쿨다운이 없어 즉시 재사용 불가능하지만, 층당 1번 제한으로 균형 유지
- **영향**: 더 신중한 힐 사용 필요, 각 층에서 1번의 "세이브" 기회

### 방어 변경
- **장점**: 명확한 50% 감소로 예측 가능
- **단점**: 방어력 보너스 방식보다 단순함
- **영향**: 방어의 효과가 더 명확하고 강력해짐

## 호환성

기존 BT는 계속 작동하지만, 다음 사항 고려 필요:
- `CanHeal()` 조건의 의미 변경 (쿨다운 → 층당 사용 여부)
- 힐 전략 재조정 필요 (각 층에서 언제 사용할지)
- 방어 효과 증가로 인한 전략 변화 가능
